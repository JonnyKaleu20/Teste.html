<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Conte√∫dos - Amor</title>
  <link rel="icon" href="image/heart.png" type="image/x-icon" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main>
    <h1>Bem-vindo Amor üíå</h1>

    <nav>
<a href="botoes/cartinha.html" class="btnCartinhas">Cartinhas</a>
<a href="botoes/batepapo.html" class="btnBatePapo">Bate Papos</a>
   <a href="botoes/admin.html" class="btnAdmin">√Årea Admin</a>
      
      
    </nav>

    <!-- Se√ß√µes -->
    <section id="fotos" class="secao">
      <h2>Nossas Fotos</h2>
      <input type="file" id="photo-input" />
      <button id="btnEnviarFoto">Enviar Foto</button>
      <div class="galeria" id="galeriaFotos"></div>
    </section>

    <section id="cartinhas" class="secao" style="display:none;">
      <h2>Cartinhas</h2>

      <form id="formCartinha">
        <label for="nomeCartinha">Nome:</label><br />
        <input type="text" id="nomeCartinha" required /><br />

        <label for="textoCartinha">Mensagem:</label><br />
        <textarea id="textoCartinha" rows="4" required></textarea><br />

        <label for="arquivoCartinha">Enviar foto ou arquivo (opcional):</label><br />
        <input type="file" id="arquivoCartinha" /><br /><br />

        <button type="submit">Enviar Cartinha</button>
      </form>

      <div id="listaCartinhas" class="listaCartinhas"></div>

      <button id="voltarParaFotos">Voltar para Fotos</button>
    </section>

    <section id="batepapo" class="secao" style="display:none;">
      <h2>Bate-papo</h2>

      <form id="formBatePapo">
        <label for="nomeBatePapo">Seu nome:</label><br />
        <input type="text" id="nomeBatePapo" required /><br />

        <label for="msgBatePapo">Mensagem:</label><br />
        <textarea id="msgBatePapo" rows="3" required></textarea><br />

        <button type="submit">Enviar</button>
      </form>

      <div id="listaMensagens" class="listaMensagens"></div>
    </section>
  </main>

  <!-- Inclui seu app.js que j√° inicializa o Firebase -->
  <script src="app.js"></script>

  <script>
    // Refer√™ncias Firebase (do seu app.js)
    const messagesRef = firebase.database().ref('chatMensagens');
    const cartinhasRef = firebase.database().ref('cartinhas');
    const fotosRef = firebase.database().ref('fotos');
    const storage = firebase.storage();

    // Troca de se√ß√µes
    const btnFotos = document.getElementById('btnFotos');
    const btnCartinhas = document.getElementById('btnCartinhas');
    const btnBatePapo = document.getElementById('btnBatePapo');

    const secaoFotos = document.getElementById('fotos');
    const secaoCartinhas = document.getElementById('cartinhas');
    const secaoBatePapo = document.getElementById('batepapo');

    function mostrarSecao(secao) {
      secaoFotos.style.display = 'none';
      secaoCartinhas.style.display = 'none';
      secaoBatePapo.style.display = 'none';

      if (secao === 'fotos') secaoFotos.style.display = 'block';
      if (secao === 'cartinhas') secaoCartinhas.style.display = 'block';
      if (secao === 'batepapo') secaoBatePapo.style.display = 'block';
    }

    btnFotos.addEventListener('click', () => mostrarSecao('fotos'));
    btnCartinhas.addEventListener('click', () => mostrarSecao('cartinhas'));
    btnBatePapo.addEventListener('click', () => mostrarSecao('batepapo'));

    document.getElementById('voltarParaFotos').addEventListener('click', () => {
      mostrarSecao('fotos');
    });

    // --- GALERIA DE FOTOS ---
    const galeria = document.getElementById('galeriaFotos');
    const photoInput = document.getElementById('photo-input');
    const btnEnviarFoto = document.getElementById('btnEnviarFoto');

    function carregarFotosGaleria() {
      galeria.innerHTML = '';
      fotosRef.once('value', snapshot => {
        snapshot.forEach(childSnap => {
          const foto = childSnap.val();
          const img = document.createElement('img');
          img.src = foto.url;
          img.alt = "Foto enviada";
          img.style.maxWidth = '150px';
          img.style.margin = '5px';
          galeria.appendChild(img);
        });
      });
    }

    btnEnviarFoto.addEventListener('click', () => {
      if (photoInput.files.length === 0) {
        alert('Selecione uma foto para enviar.');
        return;
      }
      const file = photoInput.files[0];
      const storageRef = storage.ref('fotos/' + Date.now() + '_' + file.name);

      storageRef.put(file).then(() => {
        storageRef.getDownloadURL().then(url => {
          fotosRef.push({
            url: url,
            timestamp: Date.now()
          });
          alert('Foto enviada com sucesso!');
          photoInput.value = '';
          carregarFotosGaleria();
        });
      }).catch(err => {
        alert('Erro ao enviar foto: ' + err.message);
      });
    });

    carregarFotosGaleria();

    // --- CARTINHAS ---
    const formCartinha = document.getElementById('formCartinha');
    const listaCartinhas = document.getElementById('listaCartinhas');

    formCartinha.addEventListener('submit', (e) => {
      e.preventDefault();

      const nome = document.getElementById('nomeCartinha').value.trim();
      const texto = document.getElementById('textoCartinha').value.trim();
      const arquivoInput = document.getElementById('arquivoCartinha');
      const arquivo = arquivoInput.files[0];

      if (!nome || (!texto && !arquivo)) {
        alert('Por favor, preencha nome e mensagem ou envie uma imagem.');
        return;
      }

      if (arquivo) {
        const storageRef = storage.ref('cartinhas/' + Date.now() + '_' + arquivo.name);
        storageRef.put(arquivo).then(() => {
          storageRef.getDownloadURL().then(url => {
            cartinhasRef.push({
              user: nome,
              mensagem: texto,
              imageUrl: url,
              timestamp: Date.now()
            });
            formCartinha.reset();
          });
        }).catch(err => {
          alert('Erro ao enviar imagem da cartinha: ' + err.message);
        });
      } else {
        cartinhasRef.push({
          user: nome,
          mensagem: texto,
          imageUrl: '',
          timestamp: Date.now()
        });
        formCartinha.reset();
      }
    });

    cartinhasRef.on('child_added', snapshot => {
      const c = snapshot.val();
      const div = document.createElement('div');
      const data = new Date(c.timestamp).toLocaleString();

      div.style.border = '1px solid #ccc';
      div.style.padding = '10px';
      div.style.margin = '10px 0';

      div.innerHTML = `<strong>${c.user}</strong> (${data}):<br>${c.mensagem ? c.mensagem : ''}<br>`;
      if (c.imageUrl) {
        div.innerHTML += `<img src="${c.imageUrl}" style="max-width:200px; display:block; margin-top:5px;" />`;
      }
      listaCartinhas.appendChild(div);
    });

    // --- BATE-PAPO ---
    const formBatePapo = document.getElementById('formBatePapo');
    const listaMensagens = document.getElementById('listaMensagens');

    formBatePapo.addEventListener('submit', (e) => {
      e.preventDefault();

      const nome = document.getElementById('nomeBatePapo').value.trim();
      const texto = document.getElementById('msgBatePapo').value.trim();

      if (!nome || !texto) {
        alert('Preencha nome e mensagem.');
        return;
      }

      messagesRef.push({
        user: nome,
        message: texto,
        timestamp: Date.now()
      });

      formBatePapo.reset();
    });

    messagesRef.on('child_added', snapshot => {
      const msg = snapshot.val();
      const div = document.createElement('div');
      const data = new Date(msg.timestamp).toLocaleString();

      div.className = 'mensagem-batepapo';
      div.textContent = `${msg.user} (${data}): ${msg.message}`;
      listaMensagens.appendChild(div);
      listaMensagens.scrollTop = listaMensagens.scrollHeight; // scroll para baixo
    });

    // Inicialmente mostrar fotos
    mostrarSecao('fotos');
  </script>
</body>
</html>
